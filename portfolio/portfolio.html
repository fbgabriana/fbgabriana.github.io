<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Portfolio</title>
	<link rel="stylesheet" href="portfolio.css">

	<script>

	class Portfolio {

		constructor() {
			this.items = [];
			this.z = 0;
		}

		addItem = (id, title) => {

			const element = document.createElement("div");
			element.style.zIndex = this.z;
			element.classList.add("portfolio-item");
			element.id = id;

			const titlebar = document.createElement("div");
			titlebar.classList.add("titlebar");
			titlebar.innerText = title;
			element.appendChild(titlebar);

			const content = document.createElement("div");
			content.classList.add("content");
			content.innerHTML = `<p>Content of ${id}</p>`; 
			element.appendChild(content);

			let [dX, dY, clientX, clientY] = [0, 0, 0, 0];

			const dragPointerDown = event => {
				event.preventDefault();
				clientX = event.clientX;
				clientY = event.clientY;
				window.addEventListener("pointermove", dragPointerMove, false);
				window.addEventListener("pointerup", dragPointerUp, false);
				element.classList.add("grabbing");
				element.style.zIndex = this.z+++1;
			}

			const dragPointerMove = event => {
				event.preventDefault();
				dX = event.clientX - clientX;
				dY = event.clientY - clientY;
				clientX = event.clientX;
				clientY = event.clientY;
				element.style.position = "absolute";
				element.style.left = (element.offsetLeft + dX) + "px";
				element.style.top = (element.offsetTop + dY) + "px";
			}

			const dragPointerUp = event => {
				event.preventDefault();
				window.removeEventListener("pointerup", dragPointerUp, false);
				window.removeEventListener("pointermove", dragPointerMove, false);
				element.classList.remove("grabbing");
			}

			element.addEventListener("pointerdown", dragPointerDown, false);

			const portfolioItem = Object.create({
				get id() { return id },
				get element() { return element },
				get style() { return element.style },
				get title()   { return titlebar.childNodes[0].nodeValue },
				set title(string)   { titlebar.childNodes[0].nodeValue = string },
				get content() { return content.innerHTML },
				set content(string) { content.innerHTML = string },
				get thumb() { return content.dataset.thumb },
				set thumb(string) { content.style.backgroundImage=`url(thumbs/${content.dataset.thumb = string})` },
				get pos() { let rect = element.getBoundingClientRect(); return [rect.left, rect.top]},
				set pos(arr) { this.style.left = arr[0] + "px"; this.style.top = arr[1] + "px"},
				get center() { let rect = element.getBoundingClientRect(); return [rect.left + rect.width/2, rect.top + rect.height/2]},
				set center(arr) { let rect = element.getBoundingClientRect(); this.style.left = (arr[0] - rect.width/2) + "px"; this.style.top = (arr[1] - rect.height/2) + "px"},
			});

			const PortfolioItem = Object.getPrototypeOf(portfolioItem); {
				PortfolioItem.remove = () => {return this.removeItem(portfolioItem)};
				PortfolioItem.attach = () => {return this.attachItem(portfolioItem)};
			}

			return this.attachItem(portfolioItem);
		}

		attachItem = portfolioItem => {
			const idx = this.items.indexOf(portfolioItem);
			if (idx == -1) {
				this.items.push(portfolioItem);
				this[portfolioItem.id] = portfolioItem;
				document.body.appendChild(portfolioItem.element);
				return portfolioItem;
			} else return null;
		}

		removeItem = portfolioItem => {
			const idx = this.items.indexOf(portfolioItem);
			if (idx > -1) {
				this.items.splice(idx, 1);
				delete this[portfolioItem.id];
				portfolioItem.element.remove();
				return portfolioItem;
			} else return null;
		}

		alignItems(bool) {
			if (bool && this.z > 0) return 1;
			let frac = innerWidth / this.items.length;
			for (var i = 0; i < this.items.length; i++) {
				this.items[i].center = [(i + 0.5) * frac, 125];
			}
			return 0;
		}
	}

	class DropBox {

		constructor(id) {

			const element = document.createElement("div");
			element.id = id;
			element.classList.add("dropbox");
			document.body.appendChild(element);

			this.element = element;
			this.style = element.style;
			this.rect = element.getBoundingClientRect();

			window.addEventListener("pointerup", event => {
				if (event.clientX > this.rect.left  &&
					event.clientX < this.rect.right &&
					event.clientY > this.rect.top   &&
					event.clientY < this.rect.bottom ){
					this.ondrop(event);
				}
			});
		}
		ondrop() {void(0)}
	}

	let reposition = () => {
		dropbox1.style.left = (innerWidth - 256)* 1/4 + "px";
		dropbox2.style.left = (innerWidth - 256)* 3/4 + "px";
		dropbox1.style.top = (innerHeight - 256)* 3.5/4 + "px";
		dropbox2.style.top = (innerHeight - 256)* 3.5/4 + "px";
		dropbox1.rect = dropbox1.element.getBoundingClientRect();
		dropbox2.rect = dropbox2.element.getBoundingClientRect();
		portfolio.alignItems(true);
	}

	window.addEventListener("DOMContentLoaded", event => {
		main();
	});

	window.addEventListener("resize", event => {
		reposition();
	});

	let main = () => {

		portfolio = new Portfolio();

		portfolio.addItem("philastronomy", "Philippine Astronomy");
		portfolio.addItem("harmonicmeans", "Harmonic Means");
		portfolio.addItem("gg-tournament", "GG Tournament");
		portfolio.addItem("cyberhomies", "Cyber Homies");
		portfolio.addItem("instructions", "Instructions");

		dropbox1 = new DropBox("moreinfo");
		dropbox1.style.backgroundImage = "url(moreinfo.svg)";
		dropbox1.ondrop = event => {
			if (element = event.target.closest(".portfolio-item")) {
				// Do stuff...
				console.log(`Dropped ${portfolio[element.id].title} in dropbox1`);
			}
		}

		dropbox2 = new DropBox("viewsite");
		dropbox2.style.backgroundImage = "url(viewsite.svg)";
		dropbox2.ondrop = event => {
			if (element = event.target.closest(".portfolio-item")) {
				// Do stuff...
				console.log(`Dropped ${portfolio[element.id].title} in dropbox2`);
			}
		}

		portfolio["philastronomy"].content = "<p>An astronomy magazine with the Philippines in focus.</p>";
		portfolio["philastronomy"].thumb = "philastronomy.png";
		portfolio["harmonicmeans"].content = "<p>A musical band of music and mathematics enthusiasts.</p>";
		portfolio["harmonicmeans"].thumb = "harmonicmeans.png";
		portfolio["gg-tournament"].content = "<p>16‑player double elimination tournament: a JavaScript app to keep track of matches.</p>";
		portfolio["gg-tournament"].thumb = "gg-tournament.png";
		portfolio["cyberhomies"].content = "<p>Cyber Homies — our team of creative web developers.</p>";
		portfolio["cyberhomies"].thumb = "cyberhomies.png";
		portfolio["instructions"].content = "<p>Feel free to drag, drop and reposition the items!</p>";
		portfolio["instructions"].content += "<ul><li>✓ The question mark gives more info</li><li>✓ The lens lets you view the site</li></ul>";

		reposition();
	}

	</script>

</head>
<body>
</body>
</html>
